<div ng-controller="Profiles.ProfilesController">

  <div class="row">
    <div template-cache-include="plugins/kubernetes/html/tabs.html"></div>
  </div>

  <button class="btn btn-primary pull-right" ng-disabled="loading()" ng-click="refresh()">
    <i class="fa fa-refresh" ng-class="{'fa-spin': loading()}"></i> Refresh
  </button>

  <h2 class="inline-block">Profiles <i ng-show="loading()" class="fa fa-spinner fa-spin"></i> <span class="badge" ng-show="profiles.length > 0">{{selectedTags.length > 0 || !isBlank(searchFilter) ? (filteredProfiles = (profiles | selectedTags:'tags':selectedTags | filterCollection:searchFilter)).length + ' / ' + profiles.length : (filteredProfiles = profiles).length}}</span>
    <hawtio-filter ng-model="searchFilter"
                   css-class="search-input"
                   placeholder="Search..."
                   save-as="profiles-search-filter">
    </hawtio-filter>
  </h2>

  <div>
    <div class="row-fluid">
      <div class="col-md-8">
        <accordion close-others="false">
          <accordion-group ng-init="profileView = profileViews[profile.id]" is-open="profileView.openOrSingle" ng-repeat="profile in filteredProfiles">
            <accordion-heading>
              <div class="pull-left">
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': profileView.openOrSingle, 'glyphicon-chevron-right': !profileView.openOrSingle}"></i>
              </div>
              <div class="pull-right">
                <!-- See https://github.com/angular-ui/bootstrap/issues/3299 -->
                <hawtio-tag-list tags="profile.tags" selected="selectedTags"
                                 ng-click="$event.stopPropagation();$event.preventDefault();"></hawtio-tag-list>
                <input type="checkbox" ng-checked="isInGroup(selection, profile)"
                       ng-click="toggleSelectionFromGroup(selection, profile);$event.stopPropagation();">
              </div>
              <div class="ellipsis">
                {{profile.id}}
              </div>
            </accordion-heading>
            <div ng-if="profileView.openOrSingle" ng-include="'plugins/profiles/html/profileSummary.html'" onload="loadSummary(profile)"></div>
          </accordion-group>
        </accordion>
      </div>

      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-cart-arrow-down"></i> Selection</h3>
          </div>
          <div class="panel-body">
            <div ng-hide="selection.length > 0">
              <em class="text-muted">Select profiles...</em>
            </div>
            <ul class="plain-list">
              <li class="inline-block" ng-repeat="profile in selection">
                <button type="button" class="btn btn-success btn-xs"
                        ng-click="toggleSelectionFromGroup(selection, profile)">
                  {{profile.id}} <i class="glyphicon glyphicon-remove" aria-hidden="true"></i>
                </button><small><i ng-if="!$last" class="fa fa-plus text-success"></i></small>
              </li>
            </ul>
            <button class="btn btn-primary pull-right"
                    ng-disabled="!selection.length"
                    ng-click="assignProfiles()"
                    title="Assign the selected profiles to existing containers">
              <i class="fa fa-cloud-upload"></i> Assign
            </button>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-tags"></i> Tags</h3>
          </div>
          <div class="panel-body">
            <hawtio-tag-filter tags="tags"
                               selected="selectedTags"
                               collection="profiles"
                               collection-property="tags">
            </hawtio-tag-filter>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>